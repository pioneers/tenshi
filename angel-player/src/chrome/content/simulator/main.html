<html>
    <head>
        <title>test</title>
        <script type="text/javascript" src="xmlLoad.js"></script>
        <script type="text/javascript" src="Ammo/ammo.js"></script>
        <script type="text/javascript" src="Ammo/ammoWrappers.js"></script>
        <script type="text/javascript" src="Ammo/mathSupplements.js"></script>
        <script type="text/javascript" src="Actuators/Led.js"></script>
        <script type="text/javascript" src="Actuators/Motor.js"></script>
        <script type="text/javascript" src="Sensors/Infrared.js"></script>
        <script type="text/javascript" src="Sensors/Rangefinder.js"></script>
        <script type="text/javascript" src="Sensors/TouchSensor.js"></script>
        <script type="text/javascript" src="Three/SphericalCamera.js"></script>
        <script type="text/javascript" src="Three/PovCamera.js"></script>
        <script type="text/javascript" src="Three/three.min.js"></script>
        <script type="text/javascript" src="Three/threeWrappers.js"></script>
        <script type="text/javascript" src="KeyManager.js"></script>
        <script type="text/javascript" src="MasterObject.js"></script>
        <script type="text/javascript" src="PhysicsObjectManager.js"></script>
        <script type="text/javascript" src="Robot.js"></script>
        <script type="text/javascript" src="SaveManager.js"></script>
        <script type="text/javascript" src="miscFuncs.js"></script>
        <script type="text/javascript" src="Simulator.js"></script>
        <script type="text/javascript" src="../angelic/bundle.js"></script>
    </head>
    <body>
        <div id="mainScreen"></div>
        <div><a id="RF number">lele</a></div>
        <script type="text/javascript">
            var simmy = new Simulator(700, 500, document.getElementById("mainScreen"));

            // TODO (ericnguyen): wrap all these test functions and organize them elsewhere
            var keyMan = new KeyManager(document);

            var moveForwardRight = function()
            {
                simmy.robot.setMotor(3, -100);
                simmy.robot.setMotor(1, -100);
            }

            var moveForwardLeft = function()
            {
                simmy.robot.setMotor(2, 100);
                simmy.robot.setMotor(0, 100);
            }

            var moveBackLeft = function()
            {
                simmy.robot.setMotor(2, -100);
                simmy.robot.setMotor(0, -100);
            }

            var moveBackRight = function()
            {
                simmy.robot.setMotor(3, 100);
                simmy.robot.setMotor(1, 100);
            }

            var stopLeft = function()
            {
                simmy.robot.setMotor(2, 0);
                simmy.robot.setMotor(0, 0);
            }

            var stopRight = function()
            {
                simmy.robot.setMotor(3, 0);
                simmy.robot.setMotor(1, 0);
            }

            var jump = function()
            {
                simmy.robot.physicsChassi.setActivationState(1);
                simmy.robot.physicsChassi.applyCentralForce(new Ammo.btVector3(0, 10000000, 0));
                simmy.robot.physicsChassi.applyTorqueImpulse(new Ammo.btVector3(0, 1000, 0));
            }

            var readVal = function()
            {
                val = simmy.robot.sensors[0].getVal();
                document.getElementById("RF number").innerHTML = val;
                requestAnimationFrame(readVal);
            }

            var save = function()
            {
                saveFrame(simmy);
            }

            var load = function()
            {
                loadFrame(simmy);
            }

            keyMan.bindFunc(DOWN, 81, moveForwardLeft);
            keyMan.bindFunc(UP, 81, stopLeft);
            keyMan.bindFunc(DOWN, 65, moveBackLeft);
            keyMan.bindFunc(UP, 65, stopLeft);
            keyMan.bindFunc(DOWN, 69, moveForwardRight);
            keyMan.bindFunc(UP, 69, stopRight);
            keyMan.bindFunc(DOWN, 68, moveBackRight);
            keyMan.bindFunc(UP, 68, stopRight);

            keyMan.bindFunc(DOWN, 87, save);
            keyMan.bindFunc(DOWN, 83, load);

            keyMan.bindFunc(DOWN, 71, jump);

            document.onkeydown = keyMan.updateDown; // apparently, cannot pass document as reference
            document.onkeyup = keyMan.updateUp;

            simmy.render();
            readVal();
        </script>
    </body>
</html>
