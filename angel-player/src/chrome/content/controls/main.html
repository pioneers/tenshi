<!doctype html>

<html>
    <head>
        <script src="../tenshi-frontend/javascripts/vendor/jquery.js"></script>
        <script type="text/javascript" src="../angelic/bundle.js"></script>
        <script type="text/javascript">
            var current_vm = null;

            function run() {
                if (current_vm !== null) {
                    return; // Do not run multiple simultaneous vms
                }

                var require = parent.require;
                if (require === undefined) {
                    return; // Cannot run as independent page
                }

                var texteditor = require("texteditor");
                if (texteditor === undefined) {
                    throw "ERROR: text editor not yet loaded";
                }

                var text = texteditor.get_text();
                current_vm = exports.vm_generator();

                if (current_vm === null) {
                    throw "ERROR: no vm could be created. Try opening a valid VM target page"
                }

                current_vm.load_text(text);
                current_vm.start_main();
                current_vm.set_evaluation_rate(100, 0.01);
            }

            function stop() {
                if (current_vm === null) {
                    return; // No vm is running
                }

                // These arguments are special-cased to fully stop the VM
                current_vm.set_evaluation_rate(0, 0);
                current_vm = null;
            }

            function toggle_running() {
                if (current_vm === null) {
                    run();
                    $("#toggle").text("STOP");
                } else {
                    stop();
                    $("#toggle").text("RUN");
                }
            }

            var exports = {};
            exports.vm_generator = function () {return null;};
        </script>
    </head>
    <body>
        <p>
            <a href="#" id="toggle" onClick="toggle_running()">RUN</a>
        </p>
    </body>
</html>
